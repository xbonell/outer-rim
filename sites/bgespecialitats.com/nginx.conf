server {
    listen       80;
    server_name  localhost;

    root   /usr/share/nginx/html;
    index  index.html index.htm;

    # Custom 404 error page - language-specific handling
    # Serves /ca/404 or /es/404 based on URL path or Accept-Language header
    error_page 404 @language_404;

    location @language_404 {
        # Check if URL path starts with /ca/ - serve Catalan 404
        if ($request_uri ~ ^/ca/) {
            rewrite ^(.*)$ /ca/404 last;
        }
        # Check if URL path starts with /es/ - serve Spanish 404
        if ($request_uri ~ ^/es/) {
            rewrite ^(.*)$ /es/404 last;
        }
        # Check if URL path starts with /en/ - default to Spanish 404
        if ($request_uri ~ ^/en/) {
            rewrite ^(.*)$ /es/404 last;
        }
        # For root-level 404s, check Accept-Language header
        if ($http_accept_language ~* ^ca) {
            rewrite ^(.*)$ /ca/404 last;
        }
        # Default to Spanish 404
        rewrite ^(.*)$ /es/404 last;
    }

    # Location blocks to serve the actual 404 pages with try_files fallbacks
    location = /ca/404 {
        try_files /ca/404 /ca/404.html /ca/404/index.html =404;
    }

    location = /es/404 {
        try_files /es/404 /es/404.html /es/404/index.html =404;
    }

    location / {
        try_files $uri $uri/ =404;
    }

    # Error pages for other status codes
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
